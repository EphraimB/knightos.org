---
title: Miscellaneous Documentation
layout: documentation
---



<div class="row">
    <div class="col-md-8">
        <h1>Miscellaneous</h1>
        <div class="docs">
            
            <div id="callbackSort" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#callbackSort">callbackSort</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/02/sort.asm#L54">View Source</a></small>
                    </h2>
                    
                    <p>Sorts an array of arbitrarily-sized blocks using a callback function to perform comparisons.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX</dt>
                                <dd><p>Pointer to comparison function.</p></dd>
                                
                                <dt>DE</dt>
                                <dd><p>Last element in array</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>First element in array</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of element in bytes</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>The comparison function must affect the carry flag like cp (hl), (de) 
 would.  (That is, set the carry flag if (HL) &lt; (DE).)  All other registers 
 must be preserved.  The algorithm (quicksort) uses an average of O(log n) 
 stack space, with 8 bytes stack per recursion required.  Quicksort is 
 in-place and is not a stable sort.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="compareStrings" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#compareStrings">compareStrings</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L210">View Source</a></small>
                    </h2>
                    
                    <p>Determines if two strings are equal, and checks alphabetical sort order.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>String pointer</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>C</dt>
                                <dd><p>Set if string HL is alphabetically earlier than string DE</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set if equal, reset if not equal</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="compareStrings_sort" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#compareStrings_sort">compareStrings_sort</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L366">View Source</a></small>
                    </h2>
                    
                    <p>Compares strings at ((HL)) and ((DE)).  That is, calls indirect16HLDE, then calls compareStrings.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Pointer to string pointer</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Pointer to string pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>C</dt>
                                <dd><p>Set if string (HL) is alphabetically earlier than string (DE)</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set if equal, reset if not equal</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This routine is extremely useful as the callback for the <a href="miscellaneous.html#callbackSort">callbackSort</a> routine. 
 It allows sorting a list of pointers to strings by the strings' sort order.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="cpHLDE_sort" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#cpHLDE_sort">cpHLDE_sort</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L387">View Source</a></small>
                    </h2>
                    
                    <p>Compares 16-bit integers at (HL) and (DE).  That is, calls indirect16HLDE, then calls cpHLDE.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Pointer to integer</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Pointer to integer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>Flags: Same as z80 CP instruction.</p>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This routine is extremely useful as the callback for the <a href="miscellaneous.html#callbackSort">callbackSort</a> routine. 
 It allows sorting a list of 16-bit numbers.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="divACByDE" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#divACByDE">divACByDE</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/math.asm#L306">View Source</a></small>
                    </h2>
                    
                    <p>Performs <code>AC = AC / DE</code></p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>AC</dt>
                                <dd><p>AC / DE</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Remainder</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getBatteryLevel" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getBatteryLevel">getBatteryLevel</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L157">View Source</a></small>
                    </h2>
                    
                    <p>Determines the approximate battery level.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>B</dt>
                                <dd><p>Battery level</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>For 15MHz CPUs, B is a value from 0 to 4, where 0 is critical and 4 is full. 
 For 6MHz CPUs, B is either 0 or 1, where 0 is critical and 1 is good.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getBootCodeVersionString" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getBootCodeVersionString">getBootCodeVersionString</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L253">View Source</a></small>
                    </h2>
                    
                    <p>Gets the version string from the device's boot code.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This allocates memory to hold the string. Deallocate it with <a href="system.html#free">free</a> when you no longer need it.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="hexToA" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#hexToA">hexToA</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L92">View Source</a></small>
                    </h2>
                    
                    <p>Converts a hexadecimal string to a number.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Value</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="hexToHL" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#hexToHL">hexToHL</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L52">View Source</a></small>
                    </h2>
                    
                    <p>Converts a hexadecimal string to a number.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>Value</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="indirect16HL" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#indirect16HL">indirect16HL</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L355">View Source</a></small>
                    </h2>
                    
                    <p>Performs HL = (HL)</p>

                    <div class="details">
                    
                    </div>
                </div>
            </div>
            
            <div id="indirect16HLDE" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#indirect16HLDE">indirect16HLDE</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L345">View Source</a></small>
                    </h2>
                    
                    <p>Performs HL = (HL) and DE = (DE).</p>

                    <div class="details">
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This routine is useful as part of a callback for the callbackSort routine.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="integerSort" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#integerSort">integerSort</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/02/sort.asm#L1">View Source</a></small>
                    </h2>
                    
                    <p>Sorts a specified array of 8-bit numbers using a fast (time complexity O(n)) algorithm.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Last element in array</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>first element in array</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This routine is an in-place version of a radix sort, which has an O(k*n) 
 runtime for k-bit numbers.  It also requires a smaller, fixed amount of 
 stack space.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="randA" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#randA">randA</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L284">View Source</a></small>
                    </h2>
                    
                    <p>Returns a random byte in A.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>A'</dt>
                                <dd><p>seed</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>random byte</p></dd>
                                
                                <dt>A'</dt>
                                <dd><p>reseeded</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="rleCalculateCompressedLength" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#rleCalculateCompressedLength">rleCalculateCompressedLength</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/02/compression.asm#L90">View Source</a></small>
                    </h2>
                    
                    <p>Calculates the size of data resulting from a compression, but does not actually compress anything.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>Data to compress</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of decompressed data</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>Size of compressed data</p></dd>
                                
                                <dt>AF</dt>
                                <dd><p>Destroyed</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="rleCalculateDecompressedLength" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#rleCalculateDecompressedLength">rleCalculateDecompressedLength</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/02/compression.asm#L213">View Source</a></small>
                    </h2>
                    
                    <p>Calculates the size of data resulting from a decompression, but does not actually decompress anything.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>Data to decompress</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of compressed data</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>Size of decompressed data</p></dd>
                                
                                <dt>AF</dt>
                                <dd><p>Destroyed</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="rleCompress" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#rleCompress">rleCompress</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/02/compression.asm#L4">View Source</a></small>
                    </h2>
                    
                    <p>Compresses data using a simple Run-Length-Encoding scheme. All bytes in a compressed block are treated as literal, except the two following a sentinel byte (selected because of its low occurance in z80 code), which specify the length of the run and the byte to run with, respectively.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Destination, cannot (yet) be the same location as original data</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Data to compress</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of uncompressed data</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>Size of compressed data</p></dd>
                                
                                <dt>AF</dt>
                                <dd><p>Destroyed</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="rleDecompress" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#rleDecompress">rleDecompress</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/02/compression.asm#L157">View Source</a></small>
                    </h2>
                    
                    <p>Decompresses data compressed with the algorithm used by the kernel routine rleCompress.  See its documentation for algorithm details.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Destination, cannot be the same location as original data</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Data to decompress</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of compressed data</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>Size of decompressed data</p></dd>
                                
                                <dt>AF</dt>
                                <dd><p>Destroyed</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="sleep" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#sleep">sleep</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L405">View Source</a></small>
                    </h2>
                    
                    <p>Delays a number of milliseconds.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>delay in milliseconds</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>117 or 121 T-states are added when called in 6 MHz mode to the delayed time, 
 depending on the interrupt state upon calling.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="stringCopy" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#stringCopy">stringCopy</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L234">View Source</a></small>
                    </h2>
                    
                    <p>Copies a string.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Destination</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="stringLength" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#stringLength">stringLength</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/8bb1f97fdaefebe75ba2a7dcf1c4c4f7d6475145/src/00/util.asm#L137">View Source</a></small>
                    </h2>
                    
                    <p>Determines the length of a zero delimited string.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>String length</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <div class="col-md-4">
        <h4>Function Reference</h4>
        <ul class="nav doc-nav">
            
            
            <li><a href="/documentation/reference/color.html">Color</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/cryptography.html">Cryptography</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/display.html">Display</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filestreams.html">Filestreams</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filesystem.html">Filesystem</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/flash.html">Flash</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/hardware.html">Hardware</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/input.html">Input</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/maths.html">Maths</a></li>
            
            </li>
            
            
            <li class="active">
                <a href="/documentation/reference/miscellaneous.html" class="text-bold">Miscellaneous</a>
                <ul class="nav doc-nav">
                    
                    <li>
                        <a href="#callbackSort" class="text-muted">callbackSort</a>
                    </li>
                    
                    <li>
                        <a href="#compareStrings" class="text-muted">compareStrings</a>
                    </li>
                    
                    <li>
                        <a href="#compareStrings_sort" class="text-muted">compareStrings_sort</a>
                    </li>
                    
                    <li>
                        <a href="#cpHLDE_sort" class="text-muted">cpHLDE_sort</a>
                    </li>
                    
                    <li>
                        <a href="#divACByDE" class="text-muted">divACByDE</a>
                    </li>
                    
                    <li>
                        <a href="#getBatteryLevel" class="text-muted">getBatteryLevel</a>
                    </li>
                    
                    <li>
                        <a href="#getBootCodeVersionString" class="text-muted">getBootCodeVersionString</a>
                    </li>
                    
                    <li>
                        <a href="#hexToA" class="text-muted">hexToA</a>
                    </li>
                    
                    <li>
                        <a href="#hexToHL" class="text-muted">hexToHL</a>
                    </li>
                    
                    <li>
                        <a href="#indirect16HL" class="text-muted">indirect16HL</a>
                    </li>
                    
                    <li>
                        <a href="#indirect16HLDE" class="text-muted">indirect16HLDE</a>
                    </li>
                    
                    <li>
                        <a href="#integerSort" class="text-muted">integerSort</a>
                    </li>
                    
                    <li>
                        <a href="#randA" class="text-muted">randA</a>
                    </li>
                    
                    <li>
                        <a href="#rleCalculateCompressedLength" class="text-muted">rleCalculateCompressedLength</a>
                    </li>
                    
                    <li>
                        <a href="#rleCalculateDecompressedLength" class="text-muted">rleCalculateDecompressedLength</a>
                    </li>
                    
                    <li>
                        <a href="#rleCompress" class="text-muted">rleCompress</a>
                    </li>
                    
                    <li>
                        <a href="#rleDecompress" class="text-muted">rleDecompress</a>
                    </li>
                    
                    <li>
                        <a href="#sleep" class="text-muted">sleep</a>
                    </li>
                    
                    <li>
                        <a href="#stringCopy" class="text-muted">stringCopy</a>
                    </li>
                    
                    <li>
                        <a href="#stringLength" class="text-muted">stringLength</a>
                    </li>
                    
                </ul>
            </li>
            
            </li>
            
            
            <li><a href="/documentation/reference/system.html">System</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/text.html">Text</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/threading.html">Threading</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/time.html">Time</a></li>
            
            </li>
            
        </ul>
    </div>
</div>
<script type="text/javascript">

</script>