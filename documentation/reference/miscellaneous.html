---
title: Miscellaneous Documentation
layout: documentation
---



<div class="row">
    <div class="col-md-8">
        <h1>Miscellaneous</h1>
        <div class="docs">
            
            <div id="callbackSort" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#callbackSort">callbackSort</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/02/sort.asm#L54">View Source</a></small>
                    </h2>
                    
                    <p>Sorts an array of arbitrarily-sized blocks using a callback function to perform comparisons.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX</dt>
                                <dd><p>Pointer to comparison function.</p></dd>
                                
                                <dt>DE</dt>
                                <dd><p>Last element in array</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>First element in array</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of element in bytes</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>The comparison function must affect the carry flag like cp (hl), (de) 
 would.  (That is, set the carry flag if (HL) &lt; (DE).)  All other registers 
 must be preserved.  The algorithm (quicksort) uses an average of O(log n) 
 stack space, with 8 bytes stack per recursion required.  Quicksort is 
 in-place and is not a stable sort.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="cpHLDE_sort" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#cpHLDE_sort">cpHLDE_sort</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L262">View Source</a></small>
                    </h2>
                    
                    <p>Compares 16-bit integers at (HL) and (DE).  That is, calls indirect16HLDE, then calls cpHLDE.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Pointer to integer</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Pointer to integer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>Flags: Same as z80 CP instruction.</p>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This routine is extremely useful as the callback for the <a href="miscellaneous.html#callbackSort">callbackSort</a> routine. 
 It allows sorting a list of 16-bit numbers.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getBatteryLevel" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getBatteryLevel">getBatteryLevel</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L137">View Source</a></small>
                    </h2>
                    
                    <p>Determines the approximate battery level.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>B</dt>
                                <dd><p>Battery level</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>For 15MHz CPUs, B is a value from 0 to 4, where 0 is critical and 4 is full. 
 For 6MHz CPUs, B is either 0 or 1, where 0 is critical and 1 is good.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getBootCodeVersionString" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getBootCodeVersionString">getBootCodeVersionString</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L149">View Source</a></small>
                    </h2>
                    
                    <p>Gets the version string from the device's boot code.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This allocates memory to hold the string. Deallocate it with <a href="system.html#free">free</a> when you no longer need it.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getKernelCommitsSinceTag" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getKernelCommitsSinceTag">getKernelCommitsSinceTag</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L386">View Source</a></small>
                    </h2>
                    
                    <p>Returns how many commits have been made since the last kernel tag.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>set on success, reset on error</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>number of commits</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getKernelMajorVersion" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getKernelMajorVersion">getKernelMajorVersion</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L334">View Source</a></small>
                    </h2>
                    
                    <p>Returns the kernel's major version number.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>set on success, reset on error</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>major version number</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getKernelMinorVersion" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getKernelMinorVersion">getKernelMinorVersion</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L347">View Source</a></small>
                    </h2>
                    
                    <p>Returns the kernel's minor version number.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>set on success, reset on error</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>minor version number</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getKernelPatchNumber" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getKernelPatchNumber">getKernelPatchNumber</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L365">View Source</a></small>
                    </h2>
                    
                    <p>Returns the kernel's patch number.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>set on success, reset on error</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>patch number</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="getKernelShortHash" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#getKernelShortHash">getKernelShortHash</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L411">View Source</a></small>
                    </h2>
                    
                    <p>Returns the kernel's short hash, copied to malloc-ed RAM.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>set on success, reset on error</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>pointer on short hash string</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>Make sure to free HL after you're done with the string. Failure 
 to do so will result in memory leaks !!</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="hexToA" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#hexToA">hexToA</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L92">View Source</a></small>
                    </h2>
                    
                    <p>Converts a hexadecimal string to a number.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Value</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="hexToHL" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#hexToHL">hexToHL</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L52">View Source</a></small>
                    </h2>
                    
                    <p>Converts a hexadecimal string to a number.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>String pointer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>Value</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="indirect16HL" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#indirect16HL">indirect16HL</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L251">View Source</a></small>
                    </h2>
                    
                    <p>Performs HL = (HL)</p>

                    <div class="details">
                    
                    </div>
                </div>
            </div>
            
            <div id="indirect16HLDE" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#indirect16HLDE">indirect16HLDE</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L241">View Source</a></small>
                    </h2>
                    
                    <p>Performs HL = (HL) and DE = (DE).</p>

                    <div class="details">
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This routine is useful as part of a callback for the callbackSort routine.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="integerSort" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#integerSort">integerSort</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/02/sort.asm#L1">View Source</a></small>
                    </h2>
                    
                    <p>Sorts a specified array of 8-bit numbers using a fast (time complexity O(n)) algorithm.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Last element in array</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>first element in array</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This routine is an in-place version of a radix sort, which has an O(k*n) 
 runtime for k-bit numbers.  It also requires a smaller, fixed amount of 
 stack space.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="isKernelDirty" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#isKernelDirty">isKernelDirty</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L459">View Source</a></small>
                    </h2>
                    
                    <p>Tests if the kernel is dirty, i.e if it has uncommited changes.</p>

                    <div class="details">
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>set if dirty</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="randA" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#randA">randA</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L180">View Source</a></small>
                    </h2>
                    
                    <p>Returns a random byte in A.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>A'</dt>
                                <dd><p>seed</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>random byte</p></dd>
                                
                                <dt>A'</dt>
                                <dd><p>reseeded</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="rleCalculateCompressedLength" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#rleCalculateCompressedLength">rleCalculateCompressedLength</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/02/compression.asm#L90">View Source</a></small>
                    </h2>
                    
                    <p>Calculates the size of data resulting from a compression, but does not actually compress anything.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>Data to compress</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of decompressed data</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>Size of compressed data</p></dd>
                                
                                <dt>AF</dt>
                                <dd><p>Destroyed</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="rleCalculateDecompressedLength" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#rleCalculateDecompressedLength">rleCalculateDecompressedLength</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/02/compression.asm#L213">View Source</a></small>
                    </h2>
                    
                    <p>Calculates the size of data resulting from a decompression, but does not actually decompress anything.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>Data to decompress</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of compressed data</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>Size of decompressed data</p></dd>
                                
                                <dt>AF</dt>
                                <dd><p>Destroyed</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="rleCompress" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#rleCompress">rleCompress</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/02/compression.asm#L4">View Source</a></small>
                    </h2>
                    
                    <p>Compresses data using a simple Run-Length-Encoding scheme. All bytes in a compressed block are treated as literal, except the two following a sentinel byte (selected because of its low occurance in z80 code), which specify the length of the run and the byte to run with, respectively.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Destination, cannot (yet) be the same location as original data</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Data to compress</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of uncompressed data</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>Size of compressed data</p></dd>
                                
                                <dt>AF</dt>
                                <dd><p>Destroyed</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="rleDecompress" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#rleDecompress">rleDecompress</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/02/compression.asm#L157">View Source</a></small>
                    </h2>
                    
                    <p>Decompresses data compressed with the algorithm used by the kernel routine rleCompress.  See its documentation for algorithm details.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Destination, cannot be the same location as original data</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Data to decompress</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Size of compressed data</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>BC</dt>
                                <dd><p>Size of decompressed data</p></dd>
                                
                                <dt>AF</dt>
                                <dd><p>Destroyed</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="sleep" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#sleep">sleep</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/a985645e1799b8cf913b646533af9637ac4c4ee4/src/00/util.asm#L280">View Source</a></small>
                    </h2>
                    
                    <p>Delays a number of milliseconds.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>delay in milliseconds</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>117 or 121 T-states are added when called in 6 MHz mode to the delayed time, 
 depending on the interrupt state upon calling.</p>
                        
                    
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <div class="col-md-4">
        <h4>Function Reference</h4>
        <ul class="nav doc-nav">
            
            
            <li><a href="/documentation/reference/color.html">Color</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/cryptography.html">Cryptography</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/display.html">Display</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filestreams.html">Filestreams</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filesystem.html">Filesystem</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/flash.html">Flash</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/hardware.html">Hardware</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/input.html">Input</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/maths.html">Maths</a></li>
            
            </li>
            
            
            <li class="active">
                <a href="/documentation/reference/miscellaneous.html" class="text-bold">Miscellaneous</a>
                <ul class="nav doc-nav">
                    
                    <li>
                        <a href="#callbackSort" class="text-muted">callbackSort</a>
                    </li>
                    
                    <li>
                        <a href="#cpHLDE_sort" class="text-muted">cpHLDE_sort</a>
                    </li>
                    
                    <li>
                        <a href="#getBatteryLevel" class="text-muted">getBatteryLevel</a>
                    </li>
                    
                    <li>
                        <a href="#getBootCodeVersionString" class="text-muted">getBootCodeVersionString</a>
                    </li>
                    
                    <li>
                        <a href="#getKernelCommitsSinceTag" class="text-muted">getKernelCommitsSinceTag</a>
                    </li>
                    
                    <li>
                        <a href="#getKernelMajorVersion" class="text-muted">getKernelMajorVersion</a>
                    </li>
                    
                    <li>
                        <a href="#getKernelMinorVersion" class="text-muted">getKernelMinorVersion</a>
                    </li>
                    
                    <li>
                        <a href="#getKernelPatchNumber" class="text-muted">getKernelPatchNumber</a>
                    </li>
                    
                    <li>
                        <a href="#getKernelShortHash" class="text-muted">getKernelShortHash</a>
                    </li>
                    
                    <li>
                        <a href="#hexToA" class="text-muted">hexToA</a>
                    </li>
                    
                    <li>
                        <a href="#hexToHL" class="text-muted">hexToHL</a>
                    </li>
                    
                    <li>
                        <a href="#indirect16HL" class="text-muted">indirect16HL</a>
                    </li>
                    
                    <li>
                        <a href="#indirect16HLDE" class="text-muted">indirect16HLDE</a>
                    </li>
                    
                    <li>
                        <a href="#integerSort" class="text-muted">integerSort</a>
                    </li>
                    
                    <li>
                        <a href="#isKernelDirty" class="text-muted">isKernelDirty</a>
                    </li>
                    
                    <li>
                        <a href="#randA" class="text-muted">randA</a>
                    </li>
                    
                    <li>
                        <a href="#rleCalculateCompressedLength" class="text-muted">rleCalculateCompressedLength</a>
                    </li>
                    
                    <li>
                        <a href="#rleCalculateDecompressedLength" class="text-muted">rleCalculateDecompressedLength</a>
                    </li>
                    
                    <li>
                        <a href="#rleCompress" class="text-muted">rleCompress</a>
                    </li>
                    
                    <li>
                        <a href="#rleDecompress" class="text-muted">rleDecompress</a>
                    </li>
                    
                    <li>
                        <a href="#sleep" class="text-muted">sleep</a>
                    </li>
                    
                </ul>
            </li>
            
            </li>
            
            
            <li><a href="/documentation/reference/strings.html">Strings</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/system.html">System</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/text.html">Text</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/threading.html">Threading</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/time.html">Time</a></li>
            
            </li>
            
        </ul>
    </div>
</div>
<script type="text/javascript">

</script>