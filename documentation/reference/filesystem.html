---
title: Filesystem Documentation
layout: documentation
---


<p>These functions are part of the low-level filesystem driver, and interact directly with the filesystem tree. To read or write files, see the <a href="/documentation/reference/filestreams.html">filestream reference</a>.</p>


<div class="row">
    <div class="col-md-8">
        <h1>Filesystem</h1>
        <div class="docs">
            
            <div id="createDirectory" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#createDirectory">createDirectory</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L598">View Source</a></small>
                    </h2>
                    
                    <p>Creates a new directory in the filesystem and returns information about the new
filesystem entry.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Path to new directory</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Flash page (on success); Error code (on failure)</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set on success, reset on failure</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Address relative to 0x4000 (on success)</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="createDirectoryEntry" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#createDirectoryEntry">createDirectoryEntry</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L431">View Source</a></small>
                    </h2>
                    
                    <p>Creates a new directory entry in the FAT.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Parent ID</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Directory name</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>New entry Flash page (on success); Error code (on failure)</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set on success, reset on failure</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>New entry address relative to 0x4000 (on success)</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="createFileEntry" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#createFileEntry">createFileEntry</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L231">View Source</a></small>
                    </h2>
                    
                    <p>Creates a new file entry in the FAT.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IY</dt>
                                <dd><p>Section ID</p></dd>
                                
                                <dt>DE</dt>
                                <dd><p>Parent ID</p></dd>
                                
                                <dt>ABC</dt>
                                <dd><p>Length</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>File name</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>New entry Flash page (on success); Error code (on failure)</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set on success, reset on failure</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>New entry address relative to 0x4000 (on success)</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="deleteFile" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#deleteFile">deleteFile</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L1">View Source</a></small>
                    </h2>
                    
                    <p>Deletes a file.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Path to file (string pointer)</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Preserved on success, error code on failure</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set if file was deleted, reset if file did not exist</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="directoryExists" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#directoryExists">directoryExists</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L63">View Source</a></small>
                    </h2>
                    
                    <p>Determines if a directory exists.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Path to directory (string pointer)</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>Set if file exists, reset if not</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fileExists" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fileExists">fileExists</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L41">View Source</a></small>
                    </h2>
                    
                    <p>Determines if a file exists.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Path to file (string pointer)</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>Set if file exists, reset if not</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="findDirectoryEntry" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#findDirectoryEntry">findDirectoryEntry</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L833">View Source</a></small>
                    </h2>
                    
                    <p>Finds a directory entry in the FAT.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Path to directory</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Flash page (on success); Error code (on failure)</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set on success, reset on failure</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Address relative to 0x4000 (on success)</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This function returns HL=0 for the root directory. You should
handle this special case yourself. The root directory has ID 0
and has no parent directory.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="findFileEntry" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#findFileEntry">findFileEntry</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L693">View Source</a></small>
                    </h2>
                    
                    <p>Finds a file entry in the FAT.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Path to file (string pointer)</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Flash page (on success); Error code (on failure)</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set on success, reset on failure</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Address relative to 0x4000 (on success)</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="formatUnusedPages" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#formatUnusedPages">formatUnusedPages</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L967">View Source</a></small>
                    </h2>
                    
                    <p>If /bin/init is called with A set to 0xFF, this function
should be called. It may be appropriate to show the user
some sort of UI while this is processing, as it will take
some time to run.</p>

                    <div class="details">
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This function is only relevant to system-level programmers.
Most programmers do not have to concern themselves with it.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="listDirectory" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#listDirectory">listDirectory</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/cee7d31db64659077e75517d8a63be0adc03347c/src/00/filesystem.asm#L85">View Source</a></small>
                    </h2>
                    
                    <p>Lists the contents of a directory on the filesystem.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>DE</dt>
                                <dd><p>Path to directory</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Callback</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Error code on failure, preserved on success</p></dd>
                                
                                <dt>Z</dt>
                                <dd><p>Set on success, reset on failure</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This function will call your callback every time it encounters a
relevant entry on the filesystem. You are free to use IX, IY, and
the shadow registers in this callback, but must preserve all other
registers. Your function will be called with the following state:
<em> HL: Address of entry
</em> BC: Length of entry
<em> A: Type of entry
</em> kernelGarbage: Name of entry
<em> Correct page swapped into bank A
</em> Interrupts disabled (do not enable them)
You must leave these registers intact.</p>
                        
                    
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <div class="col-md-4">
        <h4>Function Reference</h4>
        <ul class="nav doc-nav">
            
            
            <li><a href="/documentation/reference/color.html">Color</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/cryptography.html">Cryptography</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/display.html">Display</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filestreams.html">Filestreams</a></li>
            
            </li>
            
            
            <li class="active">
                <a href="/documentation/reference/filesystem.html" class="text-bold">Filesystem</a>
                <ul class="nav doc-nav">
                    
                    <li>
                        <a href="#createDirectory" class="text-muted">createDirectory</a>
                    </li>
                    
                    <li>
                        <a href="#createDirectoryEntry" class="text-muted">createDirectoryEntry</a>
                    </li>
                    
                    <li>
                        <a href="#createFileEntry" class="text-muted">createFileEntry</a>
                    </li>
                    
                    <li>
                        <a href="#deleteFile" class="text-muted">deleteFile</a>
                    </li>
                    
                    <li>
                        <a href="#directoryExists" class="text-muted">directoryExists</a>
                    </li>
                    
                    <li>
                        <a href="#fileExists" class="text-muted">fileExists</a>
                    </li>
                    
                    <li>
                        <a href="#findDirectoryEntry" class="text-muted">findDirectoryEntry</a>
                    </li>
                    
                    <li>
                        <a href="#findFileEntry" class="text-muted">findFileEntry</a>
                    </li>
                    
                    <li>
                        <a href="#formatUnusedPages" class="text-muted">formatUnusedPages</a>
                    </li>
                    
                    <li>
                        <a href="#listDirectory" class="text-muted">listDirectory</a>
                    </li>
                    
                </ul>
            </li>
            
            </li>
            
            
            <li><a href="/documentation/reference/flash.html">Flash</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/hardware.html">Hardware</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/input.html">Input</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/maths.html">Maths</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/miscellaneous.html">Miscellaneous</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/system.html">System</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/text.html">Text</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/threading.html">Threading</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/time.html">Time</a></li>
            
            </li>
            
        </ul>
    </div>
</div>
<script type="text/javascript">

</script>