---
title: Miscellaneous Documentation
layout: documentation
---

<h1>Miscellaneous</h1>

<div class="docs">
    
    <div id="DEMulA" class="docsection">
        <div>
            <h2>
                <a href="#DEMulA">DEMulA</a>
            </h2>
            
            <p>Performs <code>HL = DE * A</code></p>
            
        </div>
    </div>
    
    <div id="add16To32" class="docsection">
        <div>
            <h2>
                <a href="#add16To32">add16To32</a>
            </h2>
            
            <p>Performs <code>ACIX = ACIX + DE</code></p>
            
        </div>
    </div>
    
    <div id="callbackSort" class="docsection">
        <div>
            <h2>
                <a href="#callbackSort">callbackSort</a>
            </h2>
            
            <p>Sorts an array of arbitrarily-sized blocks using a callback function to perform comparisons.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>IX</dt>
                        <dd><p>Pointer to comparison function.</p></dt>
                        
                        <dt>DE</dt>
                        <dd><p>Last element in array</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>First element in array</p></dt>
                        
                        <dt>BC</dt>
                        <dd><p>Size of element in bytes</p></dt>
                        
                    </dl>
                
            
                <h3>Notes</h3>
                
                    <p>The comparison function must affect the carry flag like cp (hl), (de) would.  (That is, set the carry flag if (HL) &lt; (DE).)  All other registers must be preserved.  The algorithm (quicksort) uses an average of O(log n) stack space, with 8 bytes stack per recursion required.  Quicksort is in-place and is not a stable sort.</p>
                
            
        </div>
    </div>
    
    <div id="compareStrings" class="docsection">
        <div>
            <h2>
                <a href="#compareStrings">compareStrings</a>
            </h2>
            
            <p>Determines if two strings are equal, and checks alphabetical sort order.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>DE</dt>
                        <dd><p>String pointer</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>String pointer</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>C</dt>
                        <dd><p>Set if string HL is alphabetically earlier than string DE</p></dt>
                        
                        <dt>Z</dt>
                        <dd><p>Set if equal, reset if not equal</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="compareStrings_sort" class="docsection">
        <div>
            <h2>
                <a href="#compareStrings_sort">compareStrings_sort</a>
            </h2>
            
            <p>Compares strings at ((HL)) and ((DE)).  That is, calls indirect16HLDE, then calls compareStrings.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>DE</dt>
                        <dd><p>Pointer to string pointer</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>Pointer to string pointer</p></dt>
                        
                    </dl>
                
            
                <h3>Notes</h3>
                
                    <p>This routine is extremely useful as the callback for the callbackSort routine. It allows sorting a list of pointers to strings by the strings' sort order.</p>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>C</dt>
                        <dd><p>Set if string (HL) is alphabetically earlier than string (DE)</p></dt>
                        
                        <dt>Z</dt>
                        <dd><p>Set if equal, reset if not equal</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="cpBCDE" class="docsection">
        <div>
            <h2>
                <a href="#cpBCDE">cpBCDE</a>
            </h2>
            
            <p>Compares DE to BC.</p>
            
                <h3>Output</h3>
                
                    <p>Same as z80 CP instruction.</p>
                
            
        </div>
    </div>
    
    <div id="cpHLBC" class="docsection">
        <div>
            <h2>
                <a href="#cpHLBC">cpHLBC</a>
            </h2>
            
            <p>Compares HL to BC.</p>
            
                <h3>Output</h3>
                
                    <p>Same as z80 CP instruction.</p>
                
            
        </div>
    </div>
    
    <div id="cpHLDE" class="docsection">
        <div>
            <h2>
                <a href="#cpHLDE">cpHLDE</a>
            </h2>
            
            <p>Compares HL to DE.</p>
            
                <h3>Output</h3>
                
                    <p>Same as z80 CP instruction.</p>
                
            
        </div>
    </div>
    
    <div id="cpHLDE_sort" class="docsection">
        <div>
            <h2>
                <a href="#cpHLDE_sort">cpHLDE_sort</a>
            </h2>
            
            <p>Compares 16-bit integers at (HL) and (DE).  That is, calls indirect16HLDE, then calls cpHLDE.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>DE</dt>
                        <dd><p>Pointer to integer</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>Pointer to integer</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>Same as z80 CP instruction.
;; Notes</dt>
                        <dd></dt>
                        
                        <dt>This routine is extremely useful as the callback for the callbackSort routine.
;;  It allows sorting a list of 16-bit numbers.
cpHLDE_sort</dt>
                        <dd></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="div32By16" class="docsection">
        <div>
            <h2>
                <a href="#div32By16">div32By16</a>
            </h2>
            
            <p>Performs <code>ACIX = ACIX / DE</code></p>
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>As described above, and</dt>
                        <dd></dt>
                        
                        <dt>B</dt>
                        <dd><p>0</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>Remainder</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="divACByDE" class="docsection">
        <div>
            <h2>
                <a href="#divACByDE">divACByDE</a>
            </h2>
            
            <p>Performs <code>AC = AC / DE</code></p>
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>As described above, and</dt>
                        <dd></dt>
                        
                        <dt>HL</dt>
                        <dd><p>Remainder</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="divHLByC" class="docsection">
        <div>
            <h2>
                <a href="#divHLByC">divHLByC</a>
            </h2>
            
            <p>Performs <code>HL = HL / C</code></p>
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>A</dt>
                        <dd><p>Remainder</p></dt>
                        
                        <dt>As described above, and</dt>
                        <dd></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="getBatteryLevel" class="docsection">
        <div>
            <h2>
                <a href="#getBatteryLevel">getBatteryLevel</a>
            </h2>
            
            <p>Determines the approximate battery level.</p>
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>B</dt>
                        <dd><p>Battery level</p></dt>
                        
                    </dl>
                
            
                <h3>Notes</h3>
                
                    <p>For 15MHz CPUs, B is a value from 0 to 4, where 0 is critical and 4 is full. For 6MHz CPUs, B is either 0 or 1, where 0 is critical and 1 is good.</p>
                
            
        </div>
    </div>
    
    <div id="getBootCodeVersionString" class="docsection">
        <div>
            <h2>
                <a href="#getBootCodeVersionString">getBootCodeVersionString</a>
            </h2>
            
            <p>Gets the version string from the device's boot code.</p>
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>HL</dt>
                        <dd><p>String pointer</p></dt>
                        
                    </dl>
                
            
                <h3>Notes</h3>
                
                    <p>This allocates memory to hold the string. Deallocate it with <a href="system.html#free">free</a> when you no longer need it.</p>
                
            
        </div>
    </div>
    
    <div id="hexToA" class="docsection">
        <div>
            <h2>
                <a href="#hexToA">hexToA</a>
            </h2>
            
            <p>Converts a hexadecimal string to a number.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>HL</dt>
                        <dd><p>String pointer</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>A</dt>
                        <dd><p>Value</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="hexToHL" class="docsection">
        <div>
            <h2>
                <a href="#hexToHL">hexToHL</a>
            </h2>
            
            <p>Converts a hexadecimal string to a number.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>HL</dt>
                        <dd><p>String pointer</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>HL</dt>
                        <dd><p>Value</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="indirect16HL" class="docsection">
        <div>
            <h2>
                <a href="#indirect16HL">indirect16HL</a>
            </h2>
            
            <p>Performs HL = (HL)</p>
            
        </div>
    </div>
    
    <div id="indirect16HLDE" class="docsection">
        <div>
            <h2>
                <a href="#indirect16HLDE">indirect16HLDE</a>
            </h2>
            
            <p>Performs HL = (HL) and DE = (DE).</p>
            
                <h3>Notes</h3>
                
                    <p>This routine is useful as part of a callback for the callbackSort routine.</p>
                
            
        </div>
    </div>
    
    <div id="integerSort" class="docsection">
        <div>
            <h2>
                <a href="#integerSort">integerSort</a>
            </h2>
            
            <p>Sorts a specified array of 8-bit numbers using a fast (time complexity O(n)) algorithm.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>DE</dt>
                        <dd><p>Last element in array</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>first element in array</p></dt>
                        
                    </dl>
                
            
                <h3>Notes</h3>
                
                    <p>This routine is an in-place version of a radix sort, which has an O(k*n) runtime for k-bit numbers.  It also requires a smaller, fixed amount of stack space.</p>
                
            
        </div>
    </div>
    
    <div id="randA" class="docsection">
        <div>
            <h2>
                <a href="#randA">randA</a>
            </h2>
            
            <p>Returns a random byte in A.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>A'</dt>
                        <dd><p>seed</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>A</dt>
                        <dd><p>random byte</p></dt>
                        
                        <dt>A'</dt>
                        <dd><p>reseeded</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="rleCalculateCompressedLength" class="docsection">
        <div>
            <h2>
                <a href="#rleCalculateCompressedLength">rleCalculateCompressedLength</a>
            </h2>
            
            <p>Calculates the size of data resulting from a compression, but does not actually compress anything.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>HL</dt>
                        <dd><p>Data to compress</p></dt>
                        
                        <dt>BC</dt>
                        <dd><p>Size of decompressed data</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>BC</dt>
                        <dd><p>Size of compressed data</p></dt>
                        
                        <dt>AF</dt>
                        <dd><p>Destroyed</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="rleCalculateDecompressedLength" class="docsection">
        <div>
            <h2>
                <a href="#rleCalculateDecompressedLength">rleCalculateDecompressedLength</a>
            </h2>
            
            <p>Calculates the size of data resulting from a decompression, but does not actually decompress anything.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>HL</dt>
                        <dd><p>Data to decompress</p></dt>
                        
                        <dt>BC</dt>
                        <dd><p>Size of compressed data</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>BC</dt>
                        <dd><p>Size of decompressed data</p></dt>
                        
                        <dt>AF</dt>
                        <dd><p>Destroyed</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="rleCompress" class="docsection">
        <div>
            <h2>
                <a href="#rleCompress">rleCompress</a>
            </h2>
            
            <p>Compresses data using a simple Run-Length-Encoding scheme. All bytes in a compressed block are treated as literal, except the two following a sentinel byte (selected because of its low occurance in z80 code), which specify the length of the run and the byte to run with, respectively.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>DE</dt>
                        <dd><p>Destination, cannot (yet) be the same location as original data</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>Data to compress</p></dt>
                        
                        <dt>BC</dt>
                        <dd><p>Size of uncompressed data</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>BC</dt>
                        <dd><p>Size of compressed data</p></dt>
                        
                        <dt>AF</dt>
                        <dd><p>Destroyed</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="rleDecompress" class="docsection">
        <div>
            <h2>
                <a href="#rleDecompress">rleDecompress</a>
            </h2>
            
            <p>Decompresses data compressed with the algorithm used by the kernel routine rleCompress.  See its documentation for algorithm details.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>DE</dt>
                        <dd><p>Destination, cannot be the same location as original data</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>Data to decompress</p></dt>
                        
                        <dt>BC</dt>
                        <dd><p>Size of compressed data</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>BC</dt>
                        <dd><p>Size of decompressed data</p></dt>
                        
                        <dt>AF</dt>
                        <dd><p>Destroyed</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="stringCopy" class="docsection">
        <div>
            <h2>
                <a href="#stringCopy">stringCopy</a>
            </h2>
            
            <p>Copies a string.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>DE</dt>
                        <dd><p>Destination</p></dt>
                        
                        <dt>HL</dt>
                        <dd><p>String pointer</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="stringLength" class="docsection">
        <div>
            <h2>
                <a href="#stringLength">stringLength</a>
            </h2>
            
            <p>Determines the length of a zero delimited string.</p>
            
                <h3>Inputs</h3>
                
                    <dl>
                        
                        <dt>HL</dt>
                        <dd><p>String pointer</p></dt>
                        
                    </dl>
                
            
                <h3>Outputs</h3>
                
                    <dl>
                        
                        <dt>BC</dt>
                        <dd><p>String length</p></dt>
                        
                    </dl>
                
            
        </div>
    </div>
    
    <div id="sub16From32" class="docsection">
        <div>
            <h2>
                <a href="#sub16From32">sub16From32</a>
            </h2>
            
            <p>Performs <code>ACIX = ACIX - DE</code></p>
            
        </div>
    </div>
    
</div>